# Cursor Project Rules - decaminoserviciosapp
# Pentru detalii complete, vezi: MASTER_LEAD_INSTRUCTION.md

## ğŸ”´ REGULI CRITICE - OBLIGATORII

### 0. FÄƒrÄƒ implementare implicitÄƒ
- DacÄƒ utilizatorul **NU** spune explicit â€Aprobatâ€, â€AplicÄƒâ€, â€ImplementeazÄƒâ€:
  - â†’ **NU** scriu cod
  - â†’ **NU** generez diff
  - â†’ **NU** sugerez snippet-uri gata de copiat
- Orice propunere rÄƒmÃ¢ne doar ca descriere/explicaÈ›ie pÃ¢nÄƒ la aprobare explicitÄƒ

### 1. Proces "Explain-first, then modify"
- **NICIODATÄ‚** nu scriu cod/diff/patch pÃ¢nÄƒ cÃ¢nd utilizatorul spune explicit "Aprobat" sau "Aprobat pentru modificÄƒri DB"
- Ãntotdeauna: Analizez â†’ Raportez Ã®n romÃ¢nÄƒ â†’ AÈ™tept aprobare â†’ Aplic modificÄƒrile
- Raportul trebuie sÄƒ includÄƒ: problemÄƒ gÄƒsitÄƒ, severitate (Critical/Medium/Minor), fiÈ™iere afectate, soluÈ›ie propusÄƒ, impact tehnic

### 2. Prisma & DB Safety (BLOC CRITIC)
- **STRICT INTERZIS** fÄƒrÄƒ aprobare explicitÄƒ "Aprobat pentru modificÄƒri DB":
  - `prisma migrate dev/deploy`
  - `prisma db push`
  - Orice modificare Ã®n `backend/prisma/schema.prisma` (cÃ¢mpuri, tabele, relaÈ›ii)
  - `ALTER TABLE` manuale
- **CLARIFICARE**: "Aprobat pentru modificÄƒri DB" Ã®nseamnÄƒ EXCLUSIV:
  - ModificÄƒri deliberate, descrise anterior È™i aprobate punctual
  - **NU include** optimizÄƒri â€impliciteâ€ sau refactorizÄƒri de schemÄƒ
  - **NU include** modificÄƒri â€sugerateâ€ sau â€recomandateâ€ care nu au fost explicit aprobate
- **PERMIS fÄƒrÄƒ aprobare**: queries Prisma pe schema existentÄƒ, optimizÄƒri query, servicii NestJS care citesc/scriu pe tabele existente
- Backend foloseÈ™te **100% Prisma** (nu TypeORM - deprecat)

### 3. Git Workflow
- **NICIODATÄ‚** pe `main`/`master` direct
- Propun branch `feature/...` sau `fix/...` pentru fiecare task
- Listez exact fiÈ™ierele vizate Ã®nainte de commit
- **Nu rulez comenzi git** - doar propun, utilizatorul le ruleazÄƒ

### 4. Compatibilitate UI
- MenÈ›in compatibilitatea UI Ã®n timpul migrÄƒrii n8n â†’ backend
- Frontend foloseÈ™te deja backend-ul pentru majoritatea endpoint-urilor (vezi MASTER pentru lista completÄƒ)
- Endpoint-uri nemigrate rÄƒmÃ¢n prin n8n proxy (`/api/n8n/*`)

## ğŸ“‹ ArhitecturÄƒ ActualÄƒ

### Frontend
- React 18 + Vite + Capacitor Android + PWA
- API Client: `frontend/src/utils/routes.js` - centralizeazÄƒ toate endpoint-urile
- Development: `http://localhost:3000`, Production: `https://api.decaminoservicios.com`
- Socket.io pentru WebSocket (`/notifications`, `/chat`)

### Backend
- NestJS cu **Prisma 100%** (nu TypeORM)
- Schema: `backend/prisma/schema.prisma`
- Auth: JWT (`/api/auth/login`, `/api/auth/me`), `JwtAuthGuard`, `@CurrentUser()` decorator
- n8n Proxy: `N8nProxyService` pentru endpoint-uri nemigrate (`/api/n8n/*`)
- WebSocket: `/notifications` È™i `/chat` namespaces cu JWT handshake

### Endpoint-uri Migrate (Frontend foloseÈ™te backend-ul)
âœ… Auth, Permissions, Employees CRUD, Avatar, Clientes, ContractTypes, Fichajes/Registros, Cuadrantes (GET), BajasMedicas, HorasAsignadas/Permitidas/Trabajadas, MonthlyAlerts, Grupos, Ausencias, Chat, Notifications (REST + WS), Push

â³ ÃncÄƒ prin n8n: Cuadrantes POST, Solicitudes, Inspecciones, AutoFirma, alte endpoint-uri mici

## ğŸ¯ QA & Defect Detection (Permanent)

### Caut permanent:
- **Frontend**: Spinnere infinite, API duplicate calls, cache conflicts, race conditions, PWA/SW stale updates, offline queue funcÈ›ionalitate, WS reconnect errors
- **Backend**: Rute necorecte, lipsÄƒ DTO/validare, lipsÄƒ error handling, blocaje, performanÈ›Äƒ slabÄƒ (N+1 queries), endpoints redundante
- **Prisma/DB**: N+1 queries, queries neoptime, citiri/scrieri inutile, cÃ¢mpuri cu spaÈ›ii necesitÄƒ backticks (`` `NOMBRE / APELLIDOS` ``)

La fiecare problemÄƒ: mini-audit Ã®n romÃ¢nÄƒ + soluÈ›ie propusÄƒ â†’ aÈ™tept "Aprobat"

## ğŸŒ Comunicare

- **100% Ã®n romÃ¢nÄƒ**, concis È™i structurat
- FÄƒrÄƒ teorie generalÄƒ - doar fapte È™i soluÈ›ii
- StructurÄƒ: ProblemÄƒ â†’ SoluÈ›ie â†’ Impact â†’ AÈ™tept aprobare

## ğŸ“š ReferinÈ›Äƒ

Pentru detalii complete, instrucÈ›iuni detaliate È™i liste complete de endpoint-uri, vezi: **MASTER_LEAD_INSTRUCTION.md**

